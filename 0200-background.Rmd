

# Background


## Project Location

Here is how we insert a figure and we can reference it like this - Figure \@ref(fig:overview-map). The caption is in the 
chunk header as `fig.cap`.

```{r overview-map, fig.cap = 'Overview map of Study Areas',eval=T}
knitr::include_graphics("fig/nge-icon_name.png")
```

<br>

Here is how we do multiple figures in one chunk - side by each (like toasts). We reference it like this -
Figure \@ref(fig:fig-multi).

```{r fig-multi, fig.cap = 'Multiple figures or photos side by each.', fig.show="hold", out.width= c("49.5%","1%","49.5%")}
knitr::include_graphics("data/TimePhoto_20220814_112459.jpg")
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics("data/TimePhoto_20220814_112923.jpg")
```

<br>

Here is how we conditionally include chunk output based on the `gitbook_on` parameter. If this is the gitbook version, 
the image will NOT be included. If this is the pdf version, this double image will not be included.  We do this to make the pdf version read nicely and not be a million pages long due to individual photos taking up a half a page each.


```{r fig-multi-conditional, fig.cap = 'Multiple figures or photos side by each.  Turned on conditionally with the eval parameter in the rmarkdown chunk to run only when the pdf version of the document is built.', fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}
knitr::include_graphics("data/TimePhoto_20220814_112459.jpg")
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics("data/TimePhoto_20220814_112923.jpg")
```


`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("<br><br><br><br>")`


here is a a shot at a sortable table

```{shinylive-r}
library(shiny)
library(bslib)
library(DT)

# Sample data
initial_data <- data.frame(
  Item = c("Apple", "Banana", "Orange", "Pear"),
  Price = c(1.99, 0.99, 1.49, 2.49),
  UserRating = rep(NA, 4),  # Column for user inputs
  stringsAsFactors = FALSE
)

ui <- page_sidebar(
  theme = bs_theme(),
  title = "Table with User Inputs",
  sidebar = card(
    radioButtons("sort_direction", "Sort Direction:",
                choices = c("Highest to Lowest" = "desc",
                          "Lowest to Highest" = "asc"),
                selected = "desc"),
    actionButton("sort_btn", "Sort by Ratings", class = "btn-primary")
  ),
  
  card(
    card_header("Interactive Table"),
    div(style = "padding: 15px;",
        DTOutput("table", width = "100%")
    )
  )
)

server <- function(input, output, session) {
  # Reactive value to store the current state of the data
  rv <- reactiveVal(initial_data)
  
  # Create the interactive table
  output$table <- renderDT({
    datatable(
      rv(),
      selection = 'none',
      editable = list(
        target = "cell",
        disable = list(columns = c(0, 1))  # Make only UserRating column editable
      ),
      options = list(
        pageLength = 10,
        dom = 't',  # Show only the table without other controls
        ordering = FALSE  # Disable default sorting
      )
    )
  }, server = FALSE)  # Use client-side processing
  
  # Handle cell edits
  observeEvent(input$table_cell_edit, {
    info <- input$table_cell_edit
    current_data <- rv()
    current_data[info$row, info$col] <- as.numeric(info$value)
    rv(current_data)
  })
  
  # Handle sort button click
  observeEvent(input$sort_btn, {
    current_data <- rv()
    # Only sort if there are valid ratings
    if (!all(is.na(current_data$UserRating))) {
      decreasing <- input$sort_direction == "desc"
      sorted_data <- current_data[order(current_data$UserRating, decreasing = decreasing), ]
      rv(sorted_data)
    }
  })
}

shinyApp(ui, server)
```
