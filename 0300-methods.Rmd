# Methods


```{r set-up}

if (params$project_region == "peace") {
  fish_col_permit_num <- "PG25-983916"
} else if (params$project_region == "skeena") {
  fish_col_permit_num <- "SM25-984576"
} else if (params$project_region == "fraser") {
  fish_col_permit_num <- "PG25-983997 and WL25-993485"
}

```

## Collaborative GIS Environment 
Geographical Information Systems are essential for developing and communicating restoration plans as well as the reasons
they are required and how they are developed. Without the ability to visualize the landscape and the data that is used
to make decisions, it is difficult to conduct and communicate the need for restoration, the details of past and future
plans as well as and the potential results of physical works.

<br>

To facilitate the planning and implementation of restoration activities, a collaborative GIS environment has been
established using [QGIS](https://qgis.org/en/site/) and is served on the cloud using source code stored
[here](https://github.com/MerginMaps). This environment is intended to be a space where project team members can access,
view, and contribute to the amalgamation of background spatial data and the development of restoration as well as
monitoring for the project. The collaborative GIS environment allows users to view, edit, and analyze shared, up to date
spatial data on personal computers in an office setting as well as on phones and tablets in the field. At the time of
reporting, the environment was being used to develop and share maps, conduct spatial analyses, communicate restoration
plans to stakeholders as well as to provide a central place to store methodologies and tools for conducting field
assessments on standardized pre-developed digital forms. The platform can also be used to track the progress of
restoration activities and monitor changes in the landscape over time, helping encourage the record keeping of past and
future restoration activities in a coordinated manner.

<br>

The shared QGIS project was created using scripts currently kept in
[`dff-2022`](https://github.com/NewGraphEnvironment/dff-2022) with the precise calls to project creation scripts tracked
in the `project_creation_and_permissions.txt` document kept in the main QGIS project directory. Information about the scripts used for GIS project creation and updates can be viewed
[here](https://github.com/NewGraphEnvironment/dff-2022/tree/master/scripts/qgis) with outcomes of their use summarized
below:

  - Download and clip user specified layers from the [BC Data Catalogue](https://catalogue.data.gov.bc.ca/) as well as data layers stored in custom Amazon Web Services buckets for an area of interest defined by a list of watershed groups and load to a geopackage called `background_layers.gpkg` stored in the main directory of the project.  
  - A project directory is created to hold the spatial data and `QGIS` project information (ie. layer symbology and naming conventions, metadata, etc.).
  - Metadata for individual project spatial layers is kept in the `rfp_tracking` table within the `background_layers.gpkg` along with tables related to user supplied stream width/gradient inputs to `bcfishpass` to model potentially high value habitat that is accessible to fish species of interest. 
  

```{r}
# this is good info but need to figure out where it appropriately sits
# ### Issue Tracking
# "Issues" logged on the online github platform are effective ways to track tasks, enhancements, and bugs related to project components.
# They can be referenced with the scripts, text and actions used to address them by linking documentation to the issues with text comments
# or programatically through `git` commit messages.  Issues for this project are kept `r ngr::ngr_str_link_url(url_base = params$repo_url, url_resource = "issues", anchor_text = "here")`.
```


### Mapping
The workflows to produce the georeferenced  `pdf` maps include using a QGIS layer file
defining and symbolizing all layers required and are continuously evolving. At the time of reporting - mapping scripts
and associated layer file were kept under version control within `bcfishpass` [here](https://github.com/smnorris/bcfishpass/tree/main/qgis).
Loading the QGIS layer file within a QGIS project, allows load and representation of all map component layers provided
the user points to a postgresql database populated via `bcfishpass` outputs.


## Planning

### Habitat Modelling

Habitat modelling used to help guide planning for field assessments is generated by `bcfishpass` [@norris2024smnorrisbcfishpass] which has been designed to prioritize potential fish passage barriers for assessment or remediation by generating a simple model of aquatic habitat connectivity.  We utilize the `bcfishpass` access model, linear spawning/rearing habitat model and lateral habitat connectivity for planning purposes. These models provide a valuable starting point, but their results are not definitive and should always be considered with professional judgment. Detailed information regarding model methodology, select parameters and known model limitations are detailed in @norris2024smnorrisbcfishpass with key documentation
linked below:

  - [Access model](https://smnorris.github.io/bcfishpass/02_model_access.html)
  - [Linear spawning/rearing habitat models](https://smnorris.github.io/bcfishpass/03_model_habitat_linear.html)
  - [Lateral habitat model](https://smnorris.github.io/bcfishpass/04_model_habitat_lateral.html)
  
Table \@ref(tab:tab-fish-spawning-rearing) documents the custom species-specific thresholds for stream gradient and channel width 
applied to the linear spawning and rearing habitat model for this year's project planning. 

```{r xtext-01}
# `bcfishpass` and associated tools have been designed to be flexible in analysis, accepting user defined gradient, channel width and stream discharge categories [@moeStreamInventorySample].  Although currently in draft form, and subject to development revisions, gradient and channel width thresholds for habitat with the highest intrinsic value for a number of fish species in the Parsnip River watershed group have been specified and applied to model habitat upstream of stream crossing locations with the highest potential intrinsic value (Table \@ref(tab:tab-fish-spawning-rearing)). Definitions of modelling outputs for bull trout are presented in Table \@ref(tab:tab-bcfp-def).  Modelling of habitat for Arctic grayling in the Peace region are planned for 2024-2025 with the work leveraging multiple other initiatives underway by SERNbc and others throughout British Columbia including work related to Arctic grayling habitat use and preference conducted by UNBC and others [@hagen_stamford2023ParsnipArctic; @bottoms_etal2023Criticalhabitats].
```

<br>


```{r tab-fish-spawning-rearing, eval=TRUE}
#`r if(identical(gitbook_on, FALSE)){knitr::asis_output("<br><br><br>")}`

if (params$project_region == "peace") {
  species <- c("BT","GR")
} else if (params$project_region == "skeena") {
  species <- c("CH","CM","CO","PK","SK","ST")
} else if (params$project_region == "fraser") {
  species <- c("CH","CO","SK","BT")
}

text_footnote <- ""
  #"Models for RB, GR and KO are under a process of development and have not yet been released.  All models parameters are preliminary and subject to collaborative development."


bcfishpass_spawn_rear_model |> 
  dplyr::filter(species_code %in% species) |>
  mutate(Species = fishbc::fbc_common_name(species_code),
         spawn_gradient_max = round(spawn_gradient_max * 100 ,1),
         rear_gradient_max = round(rear_gradient_max * 100 ,1)) |>
  select(Species,
         `Spawning Gradient  Max (%)`= spawn_gradient_max,
         `Spawning Width Min (m)` = spawn_channel_width_min,
         `Rearing Width Min (m)` = rear_channel_width_min,
         # `Spawning Width Max (m)` = spawn_channel_width_max,
         # `Spawning MAD Min (m3/s)` = spawn_mad_min,
         # `Spawning MAD Max (m3/s)` = spawn_mad_max,
         `Rearing Gradient Max (%)` = rear_gradient_max) |>
         # `Rearing MAD Min (m3/s)` = rear_mad_min,
         # `Rearing MAD Max (m3/s)` = rear_mad_max,
         # `Rearing Wetland Multiplier` = rear_wetland_multiplier,
         # `Rearing Lake Multiplier` = rear_lake_multiplier) |>
  t() |>
  as_tibble(rownames = "row_names") |>
  janitor::row_to_names(row_number = 1) |>
  rename(Variable = Species) |>
  fpr::fpr_kable(caption_text = 'Stream gradient and channel width thresholds used to model potentially highest value fish habitat.',
                 footnote_text = text_footnote,
                 scroll = F,
                 scroll_box_height = '300px')

```

#### Statistical Support for `bcfishpass` Fish Habitat Modelling Updates
This project provided the statistical background for updates to `bcfishpass` that facilitated incorporation of 
channel width (observed or predicted) into species specific linear spawning/rearing habitat models. In early 2021, 
Bayesian statistical methods were developed to predict channel width in all provincial freshwater atlas stream segments 
where width measurements had not previously been measured in the field.  The model was based on the relationship between 
watershed area and mean annual precipitation weighted by upstream watershed area [@thorley_irvine2021ChannelWidtha].  In 
December of 2021, @thorley_irvine2021ChannelWidtha methods were updated using a power model derived by 
@finnegan_etal2005Controlschannel which relates stream discharge to watershed area and mean annual precipitation resulting 
in @thorley_etal2021ChannelWidthc which was utilized for channel width estimates within `bcfishpass` modelling at the time 
of reporting. More detailed documentation of the methodology used to facilitate both the data collection and statistical 
analysis can be sourced in @irvine2022BulkleyRiver and @thorley_etal2021ChannelWidthc.

<br>


In 2024, in collaboration with Poisson Consulting - stream discharge and temperature causal effects pathways were mapped
with the intent of focusing aquatic restoration actions in areas of highest potential for positive impacts on fisheries 
values (ie. elimination of areas from intrinic models where water temperatures are likely too cold to support fish production). The project began with a custom mechanistic model (visually represented [here](https://github.com/poissonconsulting/fish-passage-22b?tab=readme-ov-file#dags)), but the model struggled to converge. The project then shifted to the air2stream model, which offers a middle ground between fully mechanistic models—often data-intensive and reliant on quantities that are difficult to measure or estimate—and purely statistical models, which lack physical justification and perform poorly when extrapolated to new conditions (@toffolon_piccolroaz2015hybridmodel). After several adaptations, the expected stream temperatures were best modeled using the four-parameter version of the air2stream model, with added random effects by site for each of the four parameters (@hill_etal2024Spatialstream).
The data used for the model were sourced from the following locations, for years 2019-2021:

  - Water temperature data collected in the Nechako Watershed were downloaded from [Zenodo](https://zenodo.org/records/6426024#.ZEAqr-zMI0Q) [@gilbert_etal2022Subhourlywater]. 
  - Hourly air temperature data were obtained from the ERA-5-Land dataset via the Copernicus Climate Change Service (@munozsabater2019ERA5Landhourly) 
  - Daily baseflow and surface runoff data were sourced from the [Pacific Climate Impacts Consortium’s Gridded Hydrologic Model Output](https://www.pacificclimate.org/data/gridded-hydrologic-model-output) using the ACCESS1-0_rcp85 scenario (@pacificclimateimpactsconsortiumGriddedHydrologic).
  


```{r bt-crit-hab-text-optional, results='asis', eval = params$project_region == "peace"}


cat("### Bull Trout and Arctic Grayling Critical Habitat

We collaborated with Eduardo Martins (Associate Professor at UNBC) to incorporate Arctic grayling into our collaborative
GIS project so it could be used to inform field work activities and potential remediation site prioritization. Similarly, 
critical bull trout habitat data was added to the GIS project after being obtained from Luc Turcotte (WLRS - Regional Aquatic Specialist)
and stored securely.  Bull trout data acquisition required prior completion of the Access to Secure Species and Ecosystem 
Data and Information (SEDIS) training conducted through WLRS.")


```


 
`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\newpage")`

<!-- This table has not been included in the most recent reports (skeena and peace 2023). Maybe because we now use 8.5% for ST rearing habitat, which is not what is referenced in this table (they said 7.5) or there are no salmon in the mackenzie basin?-->
```{r tab-fish-spawning-rearing-references, eval = F}
# bcfishpass_spawn_rear_model_references <- readr::read_csv(file = 'data/width_modelling/model_spawning_rearing_habitat.csv')
bcfishpass_spawn_rear_model_references <- readr::read_csv(file = 'data/inputs_raw/bcfishpass_spawn_rear_model_ref.csv')
  # select(species_code, contains('ref'), -contains(c('multiplier','mad')))

bcfishpass_spawn_rear_model_references |>
  mutate(Species = fishbc::fbc_common_name(species_code)) |>
  select(Species,
         `Spawning Gradient  Max (%)`= spawn_gradient_max,
         `Spawning Width Min (m)` = spawn_channel_width_min,
         # `Spawning Width Max (m)` = spawn_channel_width_max_ref,
         # `Spawning MAD Min (m3/s)` = spawn_mad_min,
         # `Spawning MAD Max (m3/s)` = spawn_mad_max,
         `Rearing Gradient Max (%)` = rear_gradient_max) |>
         # `Rearing Wetland Multiplier` = rear_wetland_multiplier,
         # `Rearing Lake Multiplier` = rear_lake_multiplier) |>
         # `Rearing MAD Min (m3/s)` = rear_mad_min,
         # `Rearing MAD Max (m3/s)` = rear_mad_max) |>
  t() |>
  as_tibble(rownames = "row_names") |>
  janitor::row_to_names(row_number = 1) |>
  rename(Variable = Species) |>
  fpr::fpr_kable(caption_text = 'References considered for stream gradient and channel width thresholds used to model potentially highest value fish habitat. Preliminary and subject to revisions.',
                 # footnote_text = 'The maximum gradient for steelhead rearing has been adjusted to 8.5% based on professional judgment, although references indicate 7.49%',
                 scroll = F)
```



<!-- Turn on once tables.R has been run  -->
```{r tab-bcfp-def, eval = FALSE}
xref_bcfishpass_names |>
  dplyr::filter(id_side == 1) |>
  arrange(id_join) |>
  select(Attribute = report, Definition = column_comment) |>
  fpr::fpr_kable(caption_text = 'bcfishpass outputs and associated definitions',
                 footnote_text = paste0(model_species_name, " uses a maximum gradient threshold of ", bt_network_gradient, "% to determine whether access is likely possible"),
                 scroll = F)
```


```{r tablethreshaverage, eval= FALSE}
#to quantify upstream habitat potentially available for salmonids and facilitate stream line symbology based on stream morphology.

# while high gradient sections typically  present  upstream  migration  barriers  and  less  available  habitat.  Additionally, the size of the stream (indicated by channel width) is an important determinant for habitat suitability for different species as well as specific life stages of those species. 

# `bcfishpass` was used to categorize and sum potentially accessible stream segments in the study area watersheds within gradient and width categories for each stream segment. 
# (0 - 3%, 3 - 5%, 5 - 8%, 8 - 15%, 15 - 20%) with these outputs further amalgamated to summarize and symbolize potential upstream habitat in three categories: riffle/cascade (0 - 5%), step-pool (5 - 15%) and step-pool very steep (15-20%) (Table \@ref(tab:tablethreshaverage)).  


#threshold and average gradient table
table_thresh_average <- tibble::tibble(`Gradient` = c('0 - 5%', '5 - 15%', '15 - 20%', '>20%'),
                                       `Channel Type` = c('Riffle and cascade pool', 'Step pool', 'Step pool - very steep', 'Non fish habitat'))

table_thresh_average |> 
    fpr::fpr_kable(caption_text = 'Stream gradient categories (threshold and average) and associated channel type.', scroll = F)

```


## Fish Passage Assessments

### Natural Barriers to Fish Passage
Our assessments may include natural features such as waterfalls that could limit fish passage. This informs whether upstream culvert upgrades would restore access for anadromous species (e.g., salmon) or primarily benefit resident fish already upstream. We document these features by measuring height, gradient, and pool depth, recording field observations, capturing site photographs, and reviewing background sources for context.

### Road Stream Crossings
In the field, crossings prioritized for follow-up were first assessed for fish passage following the procedures outlined in “Field Assessment for Determining Fish Passage Status of Closed Bottomed Structures” [@moe2011Fieldassessment]. The reader is referred to [@moe2011Fieldassessment] for detailed methodology.  Crossings surveyed included closed bottom structures (CBS), open bottom structures (OBS) and crossings considered “other” (i.e. fords).  Photos were taken at surveyed crossings and when possible included images of the road, crossing inlet, crossing outlet, crossing barrel, channel downstream and channel upstream of the crossing and any other relevant features.  The following information was recorded for all surveyed crossings: date of inspection, crossing reference, crew member initials, Universal Transverse Mercator (UTM) coordinates, stream name, road name and kilometer, road tenure information, crossing type, crossing subtype, culvert diameter or span for OBS, culvert length or width for OBS.  A more detailed “full assessment” was completed for all closed bottom structures and included the following parameters: presence/absence of continuous culvert embedment (yes/no), average depth of embedment, whether or not the culvert bed resembled the native stream bed, presence of and percentage backwatering, road fill depth, outlet drop, outlet pool depth, inlet drop, culvert slope, average downstream channel width, stream slope, presence/absence of beaver activity, presence/absence of fish at time of survey, type of valley fill, and a habitat value rating.  Habitat value ratings were based on channel morphology, flow characteristics (perennial, intermittent, ephemeral), fish migration patterns, the presence/absence of deep pools, un-embedded boulders, substrate, woody debris, undercut banks, aquatic vegetation and overhanging riparian vegetation (Table \@ref(tab:tab-hab-value)).

<br>


```{r tab-hab-value}
fpr_table_habvalue |>
  knitr::kable(caption = 'Habitat value criteria (Fish Passage Technical Working Group, 2011).', booktabs = T, label = NA) |>
    kableExtra::column_spec(column = 1, width_min = '1.5in') |>
    kableExtra::kable_styling(c("condensed"), full_width = T, font_size = font_set)

```

`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\pagebreak")`



Fish passage potential was determined for each stream crossing identified as a closed bottom structure as per @moe2011Fieldassessment.  The combined scores from five criteria: depth and degree to which the structure is embedded, outlet drop, stream width ratio, culvert slope, and culvert length were used to screen whether each culvert was a likely barrier to some fish species and life stages (Table \@ref(tab:tab-barrier-scoring), Table \@ref(tab:tab-barrier-result)). These criteria were developed based on data obtained from various studies and reflect an estimation for the passage of a juvenile salmon or small resident rainbow trout [@clarkinNationalInventoryAssessment2005 ;@bellFisheriesHandbookEngineering1991; @thompsonAssessingFishPassage2013]. For crossings determined to be potential barriers or barriers based on the data, a culvert fix and recommended diameter/span was proposed. 

<br>

```{r tab-barrier-scoring, eval=T}
tab <- as_tibble(t(fpr_table_barrier_scoring)) |>
  mutate(V4 = names(fpr_table_barrier_scoring)) |>
  select(V4, everything()) |>
  janitor::row_to_names(1) |>  ##turn the table sideways
  mutate(Risk = case_when(Risk == 'Value' ~ '  Value',
                          T ~ Risk))

tab |>
  fpr::fpr_kable(caption_text = 'Fish Barrier Risk Assessment (MoE 2011).', scroll = F)

```

<br>


```{r tab-barrier-result}
fpr_table_barrier_result |>
  fpr::fpr_kable(caption_text = 'Fish Barrier Scoring Results (MoE 2011).', scroll = F)

```


<br>

The habitat gain index is the quantity of modelled habitat upstream of the subject crossing and represents an estimate of habitat gained with remediation of fish passage at the crossing. For this project, a gradient threshold between accessible and non-accessible habitat was set at `r paste0(sp_network_gradient, "%")` (for a minimimum length of 100m) intended to represent the maximum gradient of which the strongest swimmers of anadromous species (`r stringr::str_to_lower(model_species_name)`) are likely to be able to migrate upstream.

<br>

For reporting of Phase 1 - fish passage assessments within the body of this report (Table \@ref(tab:tab-barrier-scoring)), a "total" value of habitat <20% output from `bcfishpass` was used to estimate the amount of habitat upstream of each crossing less than `r paste0(sp_network_gradient, "%")` gradient before a falls of height >5m - as recorded in @ProvincialObstaclesFish or documented in other `bcfishpass` online documentation. For Phase 2 - habitat confirmation sites, conservative estimates of the linear quantity of habitat to be potentially gained by fish passage restoration, `r stringr::str_to_lower(model_species_name)` rearing maximum gradient threshold (`r paste0(rear_gradient, "%")`) was used. To generate estimates for area of habitat upstream (m^2^), the estimated linear length was multiplied by half the downstream channel width measured (overall triangular channel shape) as part of the fish passage assessment protocol. Although these estimates are not generally conservative, have low accuracy and do not account for upstream stream crossing structures they allow a rough idea of the best candidates for follow up.

<br>


Potential options to remediate fish passage were selected from @moe2011Fieldassessment and included:

 + Removal (RM) - Complete removal of the structure and deactivation of the road.
 + Open Bottom Structure (OBS) - Replacement of the culvert with a bridge or other open bottom structure.  Based on consultation with FLNR road crossing engineering experts, for this project we considered bridges as the only viable option for OBS type .
 + Streambed Simulation (SS) - Replacement of the structure with a streambed simulation design culvert.  Often achieved by embedding the culvert by 40% or more. Based on consultation with FLNR engineering experts, we considered crossings on streams with a channel width of <2m and a stream gradient of <8% as candidates for replacement with streambed simulations.
 + Additional Substrate Material (EM) - Add additional substrate to the culvert and/or downstream weir to embed culvert and reduce overall velocity/turbulence.  This option was considered only when outlet drop = 0, culvert slope <1.0% and stream width ratio < 1.0.
 + Backwater (BW) - Backwatering of the structure to reduce velocity and turbulence. This option was considered only when outlet drop < 0.3m, culvert slope <2.0%, stream width ratio < 1.2 and stream profiling indicates it would be effective..


### Cost Estimates
Cost estimates for structure replacement with bridges and embedded culverts were generated based on the channel width, slope of the culvert, depth of fill, road class and road surface type. Road details were sourced from @flnrordForestTenureRoad2020 and @flnrordDigitalRoadAtlas2020 through `bcfishpass`. Interviews with Phil MacDonald, Engineering Specialist FLNR - Kootenay, Steve Page, Area Engineer - FLNR - Northern Engineering Group and Matt Hawkins - MoTi - Design Supervisor for Highway Design and Survey - Nelson were utilized to help refine estimates which have since been adjusted for inflation in 2020 and based on past experience.

<br>

Base costs for installation of bridges on forest service roads and permit roads with surfaces specified in provincial GIS road layers as rough and loose was estimated at \$30000/linear m and assumed that the road could be closed during construction and a minimum bridge span of 15m. For streams with channel widths <2m, embedded culverts were reported as an effective solution with total installation costs estimated at $100k/crossing (pers. comm. Phil MacDonald, Steve Page then adjusted for inflation in 2020). For larger streams (>6m), estimated span width increased proportionally to the size of the stream.  For crossings with large amounts of fill (>3m), the replacement bridge span was increased by an additional 3m for each 1m of fill >3m to account for cutslopes to the stream at a 1.5:1 ratio. To account for road type, a multiplier table was generated to estimate incremental cost increases with costs estimated for structure replacement on paved surfaces, railways and arterial/highways costing up to 15 times more than forest service roads due to expenses associate with design/engineering requirements, traffic control and paving.  The cost multiplier table (Table \@ref(tab:tab-cost-mult)) should be considered very approximate with refinement recommended for future projects.

`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\pagebreak")`

<!-- Turn on once tables.R has been run  -->
```{r tab-cost-mult, eval = TRUE}

sfpr_xref_road_cost() |>
  mutate(cost_m_1000s_bridge = formatC(cost_m_1000s_bridge * 15000, format="d", big.mark=",")) |>
  mutate(cost_embed_cv = formatC(cost_embed_cv * 1000, format="d", big.mark=",")) |>
  rename(
    Class = my_road_class,
    Surface = my_road_surface,
    `Class Multiplier` = road_class_mult,
    `Surface Multiplier` = road_surface_mult,
    `Bridge $/15m` = cost_m_1000s_bridge,
    `Streambed Simulation $` = cost_embed_cv
  ) |>
  dplyr::filter(!is.na(Class)) |>
  mutate(Class =case_when(
    Class == 'fsr' ~ str_to_upper(Class),
    TRUE ~ stringr::str_to_title(Class)),
    Surface = stringr::str_to_title(Surface)
  ) |> 
  # dplyr::filter(Class != 'FSR' & Surface != 'Paved') |>
  fpr::fpr_kable(caption_text = 'Cost multiplier table based on road class and surface type.', scroll = F)
```


### Climate Change Risk Assessment

In collaboration with the Ministry of Transportation and Infrastructure (MoTi), a new climate change replacement program
aims to prioritize vulnerable culverts for replacement (pers. comm Sean Wong, 2022) based on data collected and ranked
related to three categories - culvert condition, vulnerability and priority. Within the "condition" risk category - data
was collected and crossings were ranked based on erosion, embankment and blockage issues.  The "climate" risk category
included ranked assessments of the likelihood of both a flood event affecting the culvert as well as the consequence of
a flood event affecting the culvert.  Within the "priority" category the following factors were ranked - traffic volume,
community access, cost, constructability, fish bearing status and environmental impacts (Table
\@ref(tab:tab-moti-params)). This project is still in its early stages with methodology changes going forward.

<br>


```{r tab-moti-params, eval=T}

# This line can be removed once Table.R is run. Just a work around for now. 
xref_moti_climate_names <- sfpr_xref_moti_climate_names()

xref_moti_climate_names  %>%
  slice(7:nrow(.)) |>
  select(spdsht, report) |>
  rename(Parameter = spdsht, Description = report) |>
  fpr::fpr_kable(caption_text = 'Climate change data collected at MoTi culvert sites', scroll = gitbook_on)

```



## Habitat Confirmation Assessments

Following fish passage assessments, habitat confirmations were completed in accordance with procedures outlined in the document “A Checklist for Fish Habitat Confirmation Prior to the Rehabilitation of a Stream Crossing” [@confirmation_checklist_2011]. The main objective of the field surveys was to document upstream habitat quantity and quality and to determine if any other obstructions exist above or below the crossing.  Habitat value was assessed based on channel morphology, flow characteristics (perennial, intermittent, ephemeral), the presence/absence of deep  pools, un-embedded  boulders, substrate, woody debris, undercut banks, aquatic vegetation and overhanging riparian vegetation. Criteria used to rank habitat value was based on guidelines in @confirmation_checklist_2011 (Table \@ref(tab:tab-hab-value)).

<br>

During habitat confirmations, to standardize data collected and facilitate submission of the data to provincial databases, information was collected on digital field forms adapted from provincial ["Site Cards"](https://www2.gov.bc.ca/gov/content/environment/natural-resource-stewardship/laws-policies-standards-guidance/inventory-standards/aquatic-ecosystems). Habitat characteristics recorded included channel widths, wetted widths, residual pool depths, gradients, bankfull depths, stage, temperature, conductivity, pH, cover by type, substrate and channel morphology (among others). When possible, the crew surveyed downstream of the crossing to a minimum distance 300m and upstream to a minimum distance of 500 - 600m. Any  potential  obstacles  to  fish  passage  were  inventoried  with  photos, physical  descriptions  and  locations  recorded on site cards.  Surveyed routes were recorded with time-signatures on handheld GPS units.


### Fish Sampling

#### Electrofishing 
Fish sampling was conducted on a subset of sites when biological data was considered to add significant value to the physical habitat assessment information. Electrofishing was utilized for fish sampling according to stream inventory standards and procedures found in the Reconnaissance (1:20 000) Fish and Fish Habitat Inventory Manual [@resourcesinventorycommittee2001Reconnaissance20a]. A Haltech 2000 backpack electrofisher was used within discrete site units both upstream and downstream of the subject crossing with electrofisher settings and seconds, water quality parameters (i.e. conductivity, temperature and ph), start and end locations, length of site and wetted widths (average of a minimum of three) recorded. 


#### Fish Handling and Processing
Captured fish were held in buckets with sufficient water to minimize stress until processing, and multiple buckets were used when catch numbers were high. For each fish captured, fork length, weight and species was recorded with results documented in the fish data submission spreadsheet.

#### Pit Tagging

Fish with a fork length greater than 60 mm and belonging to species approved under the scientific fish collection permit `r fish_col_permit_num` were tagged with Passive Integrated Transponders (PIT tags) using the [Abdominal Cavity](https://www.youtube.com/watch?v=9CKZ9yaS5o8) method outlined by Biomark. To anesthetize fish prior to pit tagging, we used a solution of approximately 0.1 mL of clove oil per 1 L of water (1:10,000). This concentration was selected for its efficiency in providing effective sedation with minimal residual effects, making it ideal for studies in which fish are released back into their natural habitats [@fernandes_etal2017efficacyclove]. The clove oil solution was prepared in advance by dissolving pure clove oil in ethyl alcohol in a 1:9 ratio (clove oil: ethyl alcohol) to enhance solubility, then mixed into the water bucket [@fernandes_etal2017efficacyclove]. Fish were immersed in this solution until they reached an appropriate level of anesthesia for handling and then were tagged. To maintain needle sharpness and minimize injury risk, needles were replaced approximately every 10 fish. Each tagged fish was scanned with the PIT reader, and both the PIT tag ID and row ID were recorded. Once tagged, fish were placed into a bucket of fresh water and allowed to recover before being released back into the stream. Fish information and habitat data will be submitted to the province under scientific fish collection permit `r fish_col_permit_num`.


### Environmental DNA (eDNA) sampling

#### eDNA Sampling and Filtration

Environmental DNA (eDNA) samples were collected using two approaches: in-stream filtration with a Haltech EMOS eDNA sampler and a grab-and-go bottle collection method following @hobbs_etal2025EnvironmentalDNA. For both approaches, all water collected at a site (typically 1–3L) was treated as a single sample and filtered onto one MCE filter, resulting in one eDNA replicate per site. Typically, one sample was collected upstream and one downstream of the road–stream crossing, although in some cases only a downstream sample was collected. Field blanks were collected at the start of each sampling day using distilled water.


<br>

In-stream filtration was completed using Haltech reusable aluminum housings pre-loaded with mixed cellulose ester (MCE) filters (0.45µm, 1µm, or 1.5µm pore sizes). When turbidity was high, a Haltech pre-filter equipped with a 100µm nitex screen was installed upstream of the MCE filter to remove coarse material and maintain filtration efficiency. After filtration, aluminum housings were returned to their labelled bags and stored in a cooler with ice until the end of the day. Each evening, filters were removed from housings in a clean environment, transferred into coin envelopes placed inside labelled ziplock bags with silica desiccant, and stored in a freezer until shipment. Aluminum housings were sanitized with a bleach solution, reloaded with new filters, and stored in clean ziplock bags for future use.

<br>

At sites where the grab-and-go method was used, stream water was collected in sanitized 1L HDPE Nalgene bottles. For detailed procedures, see @hobbs_etal2025EnvironmentalDNA. Bottles were stored in a cooler with ice until the end of the day and then filtered through MCE filters identical to those used for the EMOS sampler. Post-filtration handling followed the same procedures as the in-stream method, with filters transferred to labelled bags with silica desiccant and frozen until shipment. Nalgene bottles were sanitized with a bleach solution after use.

<br>


All eDNA samples were shipped frozen to the University of Northern British Columbia (UNBC) laboratory for analysis.

#### eDNA Extraction

eDNA was extracted in the dedicated eDNA lab at UNBC and analysed with the protocols developed by @murray_booth2023Report2023. 


### Open Source Reporting Framework

This report is produced using open-source tools (R, bookdown) with full version control via git, enabling iterative updates. All code, data, and revision history are publicly accessible in the [project repository](`r params$repo_url`), with ongoing tasks tracked via GitHub [issues](`r paste0(params$repo_url, 'issues')`) and version history maintained in the [project changelog](`r paste0(params$repo_url, 'blob/main/NEWS.md')`).


### Aerial Imagery

Scripted processing and serving of UAV imagery collected during the project is available at https://github.com/NewGraphEnvironment/stac_uav_bc/ [@irvine2025NewGraphEnvironmentstac_uav_bc]. [`OpenDroneMap`](https://github.com/OpenDroneMap/ODM) was utilized to produce orthomosaics, digital surface models (DSMs), and digital terrain models (DTMs) [@opendronemapauthors2025OpenDroneMapODM]. To support efficient web-based access - imagery products were converted to cloud-optimized GeoTIFFs (COGs) using `rio-cogeo`, then collated accordiong to the [SpatioTemporal Asset Catalog  (STAC)](https://github.com/radiantearth/stac-spec) specification with `pystac` and uploaded to S3 storage [@cogeotiff2025cogeotiffriocogeo; @radiantearth2024STACSpatioTemporal; @pystacauthors2025stacutilspystac, @amazonwebservices2025awsawscli]. A `titiler` tile server was set up to facilitate interactive viewing of the orthoimagery and an Application Program Interface (API) leveraging `stac-fastapi-pgstac` is served at https://images.a11s.one to enable linking of collection images through QGIS as well as remote spatial and temporal querying using open source software such as `rstac` [@developmentseed2025developmentseedtitiler; @stac-utils2025stacutilsstacfastapipgstac; @simoes_etal2021Rstacpackage].  

## Engineering Design
Engineering designs were signed and sealed by professional engineers.  When possible - completed designs are loaded to the PSCIS data portal.


## Remediations
Structure replacement was conducted by project specific contractors. If not already completed, as-built drawings will be loaded to the PSCIS data portal.


## Monitoring

Monitoring of fish passage restoration sites — both proposed and completed - is essential to ensure restoration investments 
lead to meaningful ecological outcomes. Monitoring enables evaluation of whether remediation actions improve connectivity 
for fish and provides critical feedback to refine future prioritization and restoration strategies.

<br>

Baseline data collection, including fish sampling and aerial surveys via drone, are core components of this monitoring. 
While detailed methods for these activities are included in the previous habitat confirmation section, they are also 
fundamental to effectiveness monitoring, as they provide context to not only facilitate prioritization and communications
but also for detecting change following restoration.


<br>

To support consistent and targeted assessment, a custom field form was developed for routine effectiveness monitoring based
loosely on @forestinvestmentaccount2003Guidelinesinstream but tailored specifically for fish passage projects. 
Table \@ref(tab:tab-monitoring-metrics)) outlines the monitoring metrics used.

<br>

```{r tab-monitoring-metrics, eval = TRUE}
readr::read_csv('data/inputs_raw/form_monitoring_desc.csv') |> 
 mutate(Parameter = stringr::str_to_title(Parameter)) |> 
  mutate(Parameter = case_when( Parameter == "Uav_flight" ~ "UAV Flight",
                                T ~ Parameter)) |> 
  fpr::fpr_kable(scroll = F,
                 caption_text = 'Description of monitoring metrics used for effectiveness monitoring.')
```

